<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Speedway</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
 body {
   font-family: 'Nunito', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
   text-align: center;
   background-color: #f4f7f6; /* Soft off-white from index.html */
   color: #5d5d5d; /* Dark grey text from index.html */
   margin: 0;
   padding: 20px;
   display: flex;
   flex-direction: column;
   align-items: center;
   min-height: calc(100vh - 40px); /* Account for padding */
 }
 h1 {
   font-size: 2.6em;
   margin: 0 0 25px 0;
   color: #3498db; /* Friendly blue from index.html */
   font-weight: 700;
 }

 #settingsToggleBtn {
   position: absolute;
   top: 20px;
   right: 20px;
   padding: 10px 18px;
   font-size: 1em;
   background-color: #3498db; /* Friendly blue */
   color: #ffffff;
   border: none;
   border-radius: 8px;
   cursor: pointer;
   transition: background-color 0.3s ease;
   font-weight: 600;
 }
 #settingsToggleBtn:hover {
   background-color: #2980b9; /* Darker blue */
 }

 #config-area {
   position: absolute;
   top: 75px; 
   right: 20px;
   background-color: #ffffff; 
   padding: 25px 30px;
   border-radius: 15px; 
   box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); 
   border: 1px solid #e0e0e0; 
   max-width: 450px;
   z-index: 20;
   text-align: left;
 }
 #config-area label {
   display: block;
   margin-bottom: 8px;
   font-size: 1em;
   color: #7f8c8d; 
   font-weight: 600;
 }
 .config-hidden { display: none; }

 #track-container {
   width: 80%;
   max-width: 700px;
   height: auto; /* Adjust based on number of racers */
   background-color: #ffffff; /* Clean white */
   border: 1px solid #e0e0e0; /* Light border */
   border-radius: 15px; /* Softer radius */
   margin: 20px auto;
   position: relative;
   padding: 20px 0; /* Padding for top/bottom space */
   box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); /* Softer shadow */
 }
 .racer {
   position: absolute; /* JS will set top and left */
   width: 80px; /* Increased width for name + emoji */
   height: 30px; 
   border-radius: 15px; /* Rounded shape for a simple turtle body */
   display: flex;
   align-items: center;
   justify-content: center; /* Keep centered for now, can adjust */
   box-shadow: 0 2px 4px rgba(0,0,0,0.15); /* Softer shadow for racers */
   transition: left 0.1s linear; /* Smooths out the movement slightly */
   color: #ffffff; /* White text on turtle */
 }
 #start-line, #finish-line-visual {
   position: absolute;
   top: 0;
   bottom: 0;
   width: 4px;
   background-color: #bdc3c7; /* Muted grey for lines */
 }
 #start-line { left: 5%; }
 #finish-line-visual { right: 5%; }

 /* Shared card styles for controls and results area */
 #controls, #results-area {
   background-color: #ffffff; /* Clean white */
   padding: 15px;
   border-radius: 15px; /* Softer radius */
   border: 1px solid #e0e0e0; /* Light border */
   box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); /* Softer shadow */
   /* width, max-width, and margin-top will be set individually */
 }

 .game-layout {
   display: flex;
   width: 90%; /* Adjust as needed for overall width */
   max-width: 1100px; /* Max width for the side-by-side layout */
   gap: 20px; /* Space between track and results */
   margin: 20px 0; /* Vertical margin for the game area */
   align-items: flex-start; /* Align items to the top */
 }

 #track-container { /* Original card styles are kept, layout adjusted for flex */
   flex: 2; /* Track takes more space */
   min-width: 0; /* Allows shrinking in flex layout */
   margin: 0; /* Was '20px auto', now controlled by flex parent */
   width: 80%;
   max-width: 700px;
 }

 #results-area {
   /* Inherits common styles from the rule above */
   margin-left: auto; /* Pushes the element to the right */
   margin-right: 0;  /* Aligns its right edge with the body's content box right edge */ /* This line will be removed by flex */
   flex: 1; /* Results area takes less space */
   min-width: 250px; /* Ensures results area doesn't get too small */
   max-width: 350px; /* Optional: constrain max width of results */
   margin: 0; /* Reset margin, positioning handled by .game-layout */
 }
 #results-area h2 {
   color: #3498db; /* Friendly blue for sub-heading */
   margin-top: 0;
 }

 button#startRaceBtn, button#updateNamesBtn {
   padding: 12px 25px;
   font-size: 1.2em;
   background-color: #3498db; /* Friendly blue */
   color: #ffffff;
   border: none;
   border-radius: 8px;
   cursor: pointer;
   font-weight: 700;
   transition: background-color 0.3s ease;
   margin-top: 10px; /* For updateNamesBtn */
 }


 button#updateNamesBtn {
   background-color: #e67e22; /* Orange */
 }

 button#startRaceBtn:hover, button#updateNamesBtn:hover {
   background-color: #2980b9; /* Darker blue */
 }
 button#updateNamesBtn:hover {
   background-color: #d35400; /* Darker orange */
 }
 button#startRaceBtn:disabled {
   background-color: #95a5a6; /* Muted grey when disabled */
   cursor: not-allowed;
 }

 #standupOrderList {
   list-style-type: decimal;
   padding-left: 20px;
   text-align: left;
   color: #5d5d5d; /* Standard text color */
 }
 #standupOrderList li {
   font-size: 1.1em;
   margin-bottom: 5px;
   color: #2980b9; /* Darker blue for list items */
   font-weight: 600;
 }
 #namesInput { /* Style for textarea */
   width: 95%;
   min-height: 60px;
   padding: 10px;
   border-radius: 8px;
   border: 1px solid #ccc;
   background-color: #f9f9f9;
   color: #5d5d5d;
   font-family: 'Nunito', sans-serif;
   font-size: 0.95em;
   margin-bottom: 10px; /* Space before update button */
 }

 /* Responsive adjustments for smaller screens */
 @media (max-width: 768px) {
   body {
     padding: 15px; /* Reduce body padding */
     min-height: calc(100vh - 30px);
   }

   h1 {
     font-size: 2em; /* Smaller heading */
     margin-bottom: 20px;
   }

   #config-area {
     position: relative; /* Change from absolute to flow with content */
     top: auto;
     right: auto;
     width: 95%;
     max-width: 500px; /* Allow it to be reasonably wide but not overly so */
     margin: 15px auto 20px auto; /* Center it and add some vertical margin */
     z-index: 1; /* Ensure it's above static content if needed, but likely fine */
   }

   .game-layout {
     flex-direction: column; /* Stack track and results vertically */
     align-items: center;   /* Center items when stacked */
     width: 100%;           /* Take full available width */
     gap: 15px;             /* Reduce gap when stacked */
   }

   #track-container,
   #results-area {
     flex: none; /* Reset flex sizing */
     width: 95%; /* Allow them to take most of the width */
     max-width: none; /* Remove max-width constraint when stacked */
   }
 }
</style>
</head>
<body>
<h1>üèÅ Speedway üèÅ</h1>

<button id="settingsToggleBtn">‚öôÔ∏è Show Settings</button>
<div id="config-area" class="config-hidden">
  <label for="namesInput">Enter racer names (one per line or comma-separated):</label>
  <textarea id="namesInput" rows="4"></textarea>
  <button id="updateNamesBtn">Update Racers</button>
</div>

<div class="game-layout">
  <div id="track-container">
    <div id="start-line"></div>
    <div id="finish-line-visual"></div>
    <!-- Racers will be dynamically added here by JS -->
  </div>
  <div id="results-area">
    <h2>Order:</h2>
    <ol id="standupOrderList"></ol>
  </div>
</div>

 <button id="startRaceBtn">üöÄ Start Race!</button>

<script>
 const DEFAULT_NAMES = ['Kate', 'Andre', 'Juan', 'Dmytro', 'Vetura', 'Zachary', 'Lindsay'];
 const LOCAL_STORAGE_KEY = 'namesList';
 let originalNames = [...DEFAULT_NAMES];

 const RACER_COLORS = [
  '#e74c3c', // Alizarin
  '#3498db', // Peter River
  '#2ecc71', // Emerald
  '#f1c40f', // Sun Flower
  '#9b59b6', // Amethyst
  '#e67e22', // Carrot
  '#1abc9c', // Turquoise
  '#34495e', // Wet Asphalt
  '#d35400', // Pumpkin
  '#27ae60', // Nephritis
  '#c0392b', // Pomegranate
 ];

 let racersData = []; // To store { name, element, position, finished, finishTime }
 let raceInProgress = false;
 let animationFrameId = null;

 const trackContainer = document.getElementById('track-container');
 const startRaceBtn = document.getElementById('startRaceBtn');
 const standupOrderList = document.getElementById('standupOrderList');
 const settingsToggleBtn = document.getElementById("settingsToggleBtn");
 const configArea = document.getElementById("config-area");
 const namesInput = document.getElementById("namesInput");
 const updateNamesBtn = document.getElementById("updateNamesBtn");

  // Calculate finish line based on percentage to be responsive
 const finishLinePercent = 90; // 90% of track width

 function loadNamesFromStorage() {
   const storedNamesJson = localStorage.getItem(LOCAL_STORAGE_KEY);
   if (storedNamesJson) {
     try {
       const storedNames = JSON.parse(storedNamesJson);
       if (Array.isArray(storedNames) && storedNames.length > 0) {
         originalNames = [...storedNames];
       }
     } catch (e) {
       console.error("Error parsing names from localStorage:", e);
       originalNames = [...DEFAULT_NAMES]; // Fallback on error
     }
   } else {
     originalNames = [...DEFAULT_NAMES];
   }
   namesInput.value = originalNames.join('\n');
 }

 function saveNamesToStorage() {
   localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(originalNames));
 }

 function setupRacers() {
   trackContainer.querySelectorAll('.racer').forEach(el => el.remove()); // Clear old racers
   racersData = [];
   standupOrderList.innerHTML = ''; // Clear previous results
   startRaceBtn.disabled = originalNames.length === 0;
   startRaceBtn.textContent = "üöÄ Start Race!";

   if (originalNames.length === 0) {
     trackContainer.style.height = '100px'; // Minimal height if no racers
     return;
   }

   const racerHeight = 30; // Adjusted to match new CSS height
   const verticalGap = 10;
   const totalRacersHeight = originalNames.length * (racerHeight + verticalGap) - verticalGap;
   trackContainer.style.height = `${Math.max(150, totalRacersHeight + 40)}px`; // +40 for padding
   originalNames.forEach((name, index) => {
     const racerElement = document.createElement('div');
     racerElement.classList.add('racer');
     // Display turtle emoji and then the first 3 letters of the name
     racerElement.innerHTML = `<span style="font-size: 24px;">üê¢</span><span style="font-size: 0.7em; margin-left: 4px; filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.5));">${name.substring(0, 3)}</span>`;
     racerElement.style.backgroundColor = RACER_COLORS[index % RACER_COLORS.length];
    
     // Position racers at the start line (5% from left)
     racerElement.style.left = `5%`;
     racerElement.style.top = `${20 + index * (racerHeight + verticalGap)}px`; // Stagger vertically

     trackContainer.appendChild(racerElement);
     racersData.push({
       name: name,
       element: racerElement,
       positionPercent: 5, // Start at 5%
       finished: false,
       finishTime: 0
     });
   });
 }

 function raceTick() {
   if (!raceInProgress) return;

   let allFinished = true;
   const trackWidth = trackContainer.offsetWidth;

   racersData.forEach(racer => {
     if (!racer.finished) {
       allFinished = false;
       // Move by a random small percentage of the track width
       const randomBoost = (Math.random() * 0.7) + 0.2; // Move between 0.2% and 0.7% of track width
       racer.positionPercent += randomBoost;
       racer.element.style.left = `${racer.positionPercent}%`;

       if (racer.positionPercent >= finishLinePercent) {
         racer.finished = true;
         racer.finishTime = performance.now(); // More precise timing
         racer.element.style.left = `${finishLinePercent}%`; // Snap to finish line

         // Add to results - we'll sort later for display if needed, or just append
         const listItem = document.createElement('li');
         listItem.textContent = racer.name;
         standupOrderList.appendChild(listItem); // Appends as they finish
       }
     }
   });

   if (allFinished) {
     raceInProgress = false;
     startRaceBtn.disabled = false;
     startRaceBtn.textContent = "üèÅ Race Again!";
     // Sort and display final order if needed (currently appends as they finish)
     // For example, if you wanted to sort by finishTime strictly:
     // racersData.sort((a, b) => a.finishTime - b.finishTime);
     // standupOrderList.innerHTML = ''; // Clear and re-populate
     // racersData.forEach(r => { /* ... add li ... */ });
     cancelAnimationFrame(animationFrameId);
   } else {
     animationFrameId = requestAnimationFrame(raceTick);
   }
 }

 function updateNamesFromInput() {
   const inputText = namesInput.value.trim();
   const newNames = inputText ? inputText.split(/[\n,]+/).map(name => name.trim()).filter(name => name.length > 0) : [];
   originalNames = newNames.length > 0 ? [...newNames] : [...DEFAULT_NAMES];
   namesInput.value = originalNames.join('\n');
   saveNamesToStorage();
   setupRacers(); // Re-setup racers with the new list
   // Optionally hide config: toggleConfigArea(false);
   if (raceInProgress) raceInProgress = false; // Stop current race if any
 }

 startRaceBtn.addEventListener('click', () => {
   if (raceInProgress) return;

   raceInProgress = true;
   startRaceBtn.disabled = true;
   startRaceBtn.textContent = "üö¶ Racing...";
  
   // Reset racers for a new race
   setupRacers(); // This also clears the results list

   animationFrameId = requestAnimationFrame(raceTick);
 });

 function toggleConfigArea(show) {
   if (show === undefined) {
     configArea.classList.toggle("config-hidden");
   } else if (show) {
     configArea.classList.remove("config-hidden");
   } else {
     configArea.classList.add("config-hidden");
   }
   settingsToggleBtn.textContent = configArea.classList.contains("config-hidden") ? "‚öôÔ∏è Show Settings" : "‚öôÔ∏è Hide Settings";
 }

 settingsToggleBtn.addEventListener("click", () => toggleConfigArea());
 updateNamesBtn.addEventListener("click", updateNamesFromInput);

 // Initial setup
 loadNamesFromStorage();
 setupRacers();
 toggleConfigArea(false); // Hide config by default
</script>

</body>
</html>
