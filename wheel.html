<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Wheel of Standup - Smaller</title>
<style>
 body {
   font-family: Arial, sans-serif;
   text-align: center;
   background: #222;
   color: #fff;
   margin: 0;
   padding: 20px;
 }
 #wheel-container {
   position: relative;
   width: 425px;
   margin: 0 auto;
 }
 canvas {
   border: 4px solid #444;
   border-radius: 50%;
   background: #111;
   display: block;
   margin: 0 auto;
   width: 425px;
   height: 425px;
 }
 #spinBtn {
   margin-top: 20px;
   padding: 10px 24px;
   font-size: 1.1em;
   background: #00c853;
   color: white;
   border: none;
   border-radius: 8px;
   cursor: pointer;
   transition: background 0.3s;
 }
 #spinBtn:hover {
   background: #00b34e;
 }
 #winner {
   font-size: 1.3em;
   margin-top: 25px;
   color: #ffeb3b;
   min-height: 1.5em;
 }
 #indicator {
   position: absolute;
   top: -12px;
   left: 50%;
   transform: translateX(-50%) rotate(57deg);
   width: 0;
   height: 0;
   border-left: 14px solid transparent;
   border-right: 14px solid transparent;
   border-bottom: 22px solid red;
   z-index: 10;
   filter: drop-shadow(0 0 3px black);
 }
</style>
</head>
<body>

<h1>ðŸŽ¯ Wheel of Standup</h1>

<div id="wheel-container">
 <div id="indicator"></div>
 <canvas id="wheel" width="350" height="350"></canvas>
</div>

<button id="spinBtn">ðŸŽ² SPIN!</button>
<div id="winner"></div>

<script>
 const originalNames = ['Kate', 'Andre', 'Juan', 'Dmytro', 'Vetura', 'Zachary', 'Lindsay'];
 let remaining = [...originalNames];

 const canvas = document.getElementById("wheel");
 const ctx = canvas.getContext("2d");
 const spinBtn = document.getElementById("spinBtn");
 const winnerDiv = document.getElementById("winner");
 const radius = canvas.width / 2;

 let isSpinning = false;
 let lastWinnerIndex = null;

 function drawWheel(names, rotationAngle = 0) {
   const angleStep = (2 * Math.PI) / names.length;
   ctx.clearRect(0, 0, canvas.width, canvas.height);

   ctx.save();
   ctx.translate(radius, radius);
   ctx.rotate(rotationAngle);
   ctx.translate(-radius, -radius);

   names.forEach((name, i) => {
     const angle = i * angleStep;
     ctx.beginPath();
     ctx.moveTo(radius, radius);
     ctx.arc(radius, radius, radius, angle, angle + angleStep);
     ctx.fillStyle = `hsl(${(i * 360) / names.length}, 80%, 60%)`;
     ctx.fill();

     // Draw text in the middle of each slice
     ctx.save();
     ctx.translate(radius, radius);
     ctx.rotate(angle + angleStep / 2);
     ctx.textAlign = "right";
     ctx.fillStyle = "#000";
     ctx.font = "bold 16px Arial";
     ctx.fillText(name, radius - 15, 6);
     ctx.restore();
   });

   ctx.restore();
 }

 function spinWheel() {
   if (isSpinning) return;

   // Remove last winner if present
   if (lastWinnerIndex !== null) {
     remaining.splice(lastWinnerIndex, 1);
     lastWinnerIndex = null;
     winnerDiv.innerText = "";
     drawWheel(remaining, 0);
     if (remaining.length === 0) {
       winnerDiv.innerText = "âœ… All done! Everyone has spoken.";
       remaining = [...originalNames]
       return;
     }
   }

   if (remaining.length === 0) {
     winnerDiv.innerText = "âœ… All done!";
     return;
   }

   isSpinning = true;

   const angleStep = (2 * Math.PI) / remaining.length;
   const selectedIndex = Math.floor(Math.random() * remaining.length);
   const selectedName = remaining[selectedIndex];

   // Calculate target rotation to align selected slice center with pointer at top (-90 degrees = 3pi/2 radians)
   const fullSpins = 4;
   const targetRotation = (fullSpins * 2 * Math.PI) + (3 * Math.PI / 2) - (selectedIndex * angleStep + angleStep / 2);

   let currentRotation = 0;

   function animate() {
     const progress = currentRotation / targetRotation;
     const easeOutSpeed = Math.max(0.01, (1 - progress) * 0.7);
     currentRotation += easeOutSpeed;

     drawWheel(remaining, currentRotation);

     if (currentRotation < targetRotation) {
       requestAnimationFrame(animate);
     } else {
       lastWinnerIndex = selectedIndex;
       winnerDiv.innerHTML = `ðŸŽ‰ <strong>${selectedName}</strong> is next to speak!`;
       isSpinning = false;
     }
   }

   animate();
 }

 spinBtn.addEventListener("click", spinWheel);

 drawWheel(remaining, 0);
</script>

</body>
</html>

